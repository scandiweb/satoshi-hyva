<?php

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\SvgIcons;
use Magento\Framework\Escaper;
use Satoshi\SatoshiUi\Block\Video;

/** @var Video $block */
/** @var Escaper $escaper */
/** @var ViewModelRegistry $viewModels */

/** @var SvgIcons $hyvaicons */
$hyvaicons = $viewModels->require(SvgIcons::class);

$videoUrl = $block->getData('video_source');
$imageUrl = $block->getData('image');
$heading = $block->getData('heading');
$subheading = $block->getData('subheading');
$autoplay = $block->getData('autoplay');

?>
<div>
    <noscript>
        <a
            href="<?= $escaper->escapeUrl($videoUrl) ?>"
            class="relative [[data-appearance='contained']_&]:rounded-xl overflow-hidden"
        >
            <?php if(!empty($imageUrl)): ?>
                <div class="h-full w-full">
                    <img
                        src="<?= $escaper->escapeUrl($imageUrl) ?>"
                        alt="<?= $escaper->escapeHtmlAttr($subheading) ?>"
                        class="h-[calc(640px/1.816)] md:h-[calc(768px/1.816)] lg:h-[calc(1024px/1.816)] xl:h-[calc(1280px/1.816)] 2xl:h-[calc(1536px/1.816)] w-full object-cover"
                    />
                </div>
            <?php else: ?>
                <svg class="size-full object-cover object-center bg-secondary-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 525.5 525.5"><path d="M324.5 212.7H203c-1.6 0-2.8 1.3-2.8 2.8V308c0 1.6 1.3 2.8 2.8 2.8h121.6c1.6 0 2.8-1.3 2.8-2.8v-92.5c0-1.6-1.3-2.8-2.9-2.8zm1.1 95.3c0 .6-.5 1.1-1.1 1.1H203c-.6 0-1.1-.5-1.1-1.1v-92.5c0-.6.5-1.1 1.1-1.1h121.6c.6 0 1.1.5 1.1 1.1V308z"></path><path d="M210.4 299.5H240v.1s.1 0 .2-.1h75.2v-76.2h-105v76.2zm1.8-7.2l20-20c1.6-1.6 3.8-2.5 6.1-2.5s4.5.9 6.1 2.5l1.5 1.5 16.8 16.8c-12.9 3.3-20.7 6.3-22.8 7.2h-27.7v-5.5zm101.5-10.1c-20.1 1.7-36.7 4.8-49.1 7.9l-16.9-16.9 26.3-26.3c1.6-1.6 3.8-2.5 6.1-2.5s4.5.9 6.1 2.5l27.5 27.5v7.8zm-68.9 15.5c9.7-3.5 33.9-10.9 68.9-13.8v13.8h-68.9zm68.9-72.7v46.8l-26.2-26.2c-1.9-1.9-4.5-3-7.3-3s-5.4 1.1-7.3 3l-26.3 26.3-.9-.9c-1.9-1.9-4.5-3-7.3-3s-5.4 1.1-7.3 3l-18.8 18.8V225h101.4z"></path><path d="M232.8 254c4.6 0 8.3-3.7 8.3-8.3s-3.7-8.3-8.3-8.3-8.3 3.7-8.3 8.3 3.7 8.3 8.3 8.3zm0-14.9c3.6 0 6.6 2.9 6.6 6.6s-2.9 6.6-6.6 6.6-6.6-2.9-6.6-6.6 3-6.6 6.6-6.6z"></path></svg>
            <?php endif; ?>
            <div class="absolute top-0 flex h-full w-full items-center justify-center bg-gradient-to-b from-[#00000020] to-[#00000060] px-5">
                <div class="w-full text-secondary-500">
                    <div class="flex flex-col-reverse">
                        <h1 class="heading mb-8 text-4xl text-primary-500"><?= $escaper->escapeHtml($heading) ?></h1>
                        <h2 class="mb-3 text-lg font-semibold"><?= $escaper->escapeHtml($subheading) ?></h2>
                    </div>
                    <span class="inline-block rounded-sm border border-current p-4">
                        <?= $hyvaicons->renderHtml('play') ?>
                    </span>
                </div>
            </div>
        </a>
    </noscript>

    <div
        class="relative h-[calc(640px/1.816)] md:h-[calc(768px/1.816)] lg:h-[calc(1024px/1.816)] xl:h-[calc(1280px/1.816)] 2xl:h-[calc(1536px/1.816)] overflow-hidden [[data-appearance='contained']_&]:rounded-xl"
        x-data="{ loaded: false }"
    >
        <button
            type="button"
            <?php if (!empty($videoUrl)): ?>
                @click="loaded = true"
            <?php endif; ?>
            class="h-full w-full"
            style="text-align: inherit;"
            :class="{ 'hidden': loaded }"
        >
            <?php if(!empty($imageUrl)): ?>
                <div class="h-full w-full">
                    <img
                        src="<?= $escaper->escapeUrl($imageUrl) ?>"
                        alt="<?= $escaper->escapeHtmlAttr($subheading) ?>"
                        class="h-[calc(640px/1.816)] md:h-[calc(768px/1.816)] lg:h-[calc(1024px/1.816)] xl:h-[calc(1280px/1.816)] 2xl:h-[calc(1536px/1.816)] w-full object-cover"
                    />
                </div>
            <?php else: ?>
                <svg class="size-full object-cover object-center bg-secondary-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 525.5 525.5"><path d="M324.5 212.7H203c-1.6 0-2.8 1.3-2.8 2.8V308c0 1.6 1.3 2.8 2.8 2.8h121.6c1.6 0 2.8-1.3 2.8-2.8v-92.5c0-1.6-1.3-2.8-2.9-2.8zm1.1 95.3c0 .6-.5 1.1-1.1 1.1H203c-.6 0-1.1-.5-1.1-1.1v-92.5c0-.6.5-1.1 1.1-1.1h121.6c.6 0 1.1.5 1.1 1.1V308z"></path><path d="M210.4 299.5H240v.1s.1 0 .2-.1h75.2v-76.2h-105v76.2zm1.8-7.2l20-20c1.6-1.6 3.8-2.5 6.1-2.5s4.5.9 6.1 2.5l1.5 1.5 16.8 16.8c-12.9 3.3-20.7 6.3-22.8 7.2h-27.7v-5.5zm101.5-10.1c-20.1 1.7-36.7 4.8-49.1 7.9l-16.9-16.9 26.3-26.3c1.6-1.6 3.8-2.5 6.1-2.5s4.5.9 6.1 2.5l27.5 27.5v7.8zm-68.9 15.5c9.7-3.5 33.9-10.9 68.9-13.8v13.8h-68.9zm68.9-72.7v46.8l-26.2-26.2c-1.9-1.9-4.5-3-7.3-3s-5.4 1.1-7.3 3l-26.3 26.3-.9-.9c-1.9-1.9-4.5-3-7.3-3s-5.4 1.1-7.3 3l-18.8 18.8V225h101.4z"></path><path d="M232.8 254c4.6 0 8.3-3.7 8.3-8.3s-3.7-8.3-8.3-8.3-8.3 3.7-8.3 8.3 3.7 8.3 8.3 8.3zm0-14.9c3.6 0 6.6 2.9 6.6 6.6s-2.9 6.6-6.6 6.6-6.6-2.9-6.6-6.6 3-6.6 6.6-6.6z"></path></svg>
            <?php endif; ?>

            <div class="absolute top-0 flex h-full w-full items-center justify-center bg-gradient-to-b from-[#00000020] to-[#00000060] px-5">
                <div class="w-full text-secondary-500">
                    <div class="flex flex-col-reverse">
                        <h1 class="heading mb-8 text-4xl text-primary-500"><?= $escaper->escapeHtml($heading) ?></h1>
                        <h2 class="mb-3 text-lg font-semibold"><?= $escaper->escapeHtml($subheading) ?></h2>
                    </div>
                    <span class="inline-block rounded-sm border border-current p-4">
                        <?= $hyvaicons->renderHtml('play') ?>
                    </span>
                </div>
            </div>
        </button>
        <template x-if="loaded">
            <iframe
                src="<?= $escaper->escapeUrl($videoUrl) ?>"
                autoplay="<?= $autoplay ? 'true' : 'false' ?>"
                muted="true"
                class="h-full w-full"
                allow="autoplay; encrypted-media"
                allowfullscreen
                title="<?= $escaper->escapeHtml($heading) ?>"
            ></iframe>
        </template>
    </div>
</div>
