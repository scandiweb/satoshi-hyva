<?php

use Magento\Framework\Escaper;
use Satoshi\Theme\Block\Template;
use Hyva\Theme\Model\ViewModelRegistry;
use Magento\Framework\App\ObjectManager;
use Magento\Store\Model\StoreManagerInterface;

/** @var Escaper $escaper */
/** @var Template $template */
/** @var ViewModelRegistry $viewModels */

$storeManager = ObjectManager::getInstance()->get(StoreManagerInterface::class);
$currentStoreId = $storeManager->getStore()->getId();
$currentStoreCode = $storeManager->getStore()->getCode();
$currentStoreName = $storeManager->getStore()->getName();

$options = [];
foreach ($storeManager->getStores() as $store) {
    $storeCode = $store->getCode();
    $storeName = $store->getName();
    $storeUrl = $store->getCurrentUrl(false);
//    $storeUrl .= (strpos($storeUrl, '?') === false ? '?' : '&') . '___store=' . $storeCode;

    $options[] = [
        'value' => $escaper->escapeHtml($storeCode),
        'label' => $escaper->escapeHtml($storeName),
        'on_click' => 'window.location.href = "' . $storeUrl . '"',
    ];
}

$currentLabel = $escaper->escapeHtml($currentStoreName);
?>

<?php if (count($options) > 1): ?>
    <div class="w-full sm:w-1/2 md:w-full pr-4">
        <h2 id="language-heading" class="title-font font-medium text-gray-900 tracking-widest text-sm mb-3 uppercase">
            <?= $escaper->escapeHtml(__('Language')) ?>
        </h2>

        <?=
        $template
            ->setData([
                'id' => 'language-selector',
                'label' => $currentLabel,
                'options' => $options,
                'currentValue' => $currentStoreCode,
            ])
            ->render('Magento_Theme::html/dropdown.phtml');
        ?>
    </div>
<?php endif; ?>
