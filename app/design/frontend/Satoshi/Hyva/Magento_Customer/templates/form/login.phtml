<?php

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\Customer\LoginButton;
use Hyva\Theme\ViewModel\HeroiconsOutline;
use Magento\Customer\Block\Form\Login;
use Magento\Framework\Escaper;

/** @var Escaper $escaper */
/** @var Login $block */
/** @var LoginButton $loginButtonViewModel */
/** @var ViewModelRegistry $viewModels */
/** @var HeroiconsOutline $heroiconsoutline */

$loginButtonViewModel = $viewModels->require(LoginButton::class);

// Disabling autocomplete on form fields is not recommended,
// Enable it in Stores->Configuration->Customers configuration->Password Options

$errorMessage = $block->getErrorMessage();
$successMessage = $block->getSuccessMessage();

?>
<div class="mx-auto mb-16 w-[412px] max-w-full"
     x-data="Authentication(`<?= htmlspecialchars($block->getChildHtml('recaptcha_validation')); ?>`)">
    <div aria-labelledby="block-customer-login-heading">
        <form class="w-full"
              action="<?= $escaper->escapeUrl($block->getPostActionUrl()) ?>"
              method="post"
              id="customer-login-form"
              @submit.prevent="submitAuthForm('customer-login-form', `<?= htmlspecialchars($block->getChildHtml('recaptcha_validation')); ?>`)"
            >
            <?= $block->getBlockHtml('formkey') ?>
            <fieldset class="fieldset login">
                <legend class="flex items-center justify-between sm:text-center">
                    <h2 class="mb-7 w-full text-2xl">
                        <?= $escaper->escapeHtml(__('Login')) ?>
                    </h2>
                </legend>
                <?php if ($successMessage): ?>
                    <div class="text-primary-600">
                        <?= $successMessage ?>
                    </div>
                <?php endif; ?>
                <div class="field email required mt-3">
                    <input name="login[username]"
                        placeholder="<?= $escaper->escapeHtmlAttr(__('Email')) ?>"
                        class="input__field input__field--outline bg-bg-500 px-5 py-4"
                        required
                        value="<?= $escaper->escapeHtmlAttr($block->getUsername()) ?>"
                        autocomplete="<?= $block->isAutocompleteDisabled() ? 'off' : 'username' ?>"
                        id="email"
                        type="email"
                        title="<?= $escaper->escapeHtmlAttr(__('Email')) ?>"
                    />
                </div>
                <?php if ($errorMessage): ?>
                    <div class="text-error mt-3">
                        <?= $errorMessage ?>
                    </div>
                <?php endif; ?>
                <div class="flex items-center mt-3">
                    <input name="login[password]"
                           placeholder="<?= $escaper->escapeHtmlAttr(__('Password')) ?>"
                           class="input__field input__field--outline bg-bg-500 px-5 py-4"
                           required
                           type="password"
                           autocomplete="<?= $block->isAutocompleteDisabled() ? 'off' : 'current-password' ?>"
                           id="pass"
                           title="<?= $escaper->escapeHtmlAttr(__('Password')) ?>"
                    />
                </div>
                <?= $block->getChildHtml('form_additional_info') ?>
                <a class="link link--primary mt-2 text-sm tracking-widest" href="<?= $escaper->escapeUrl($block->getForgotPasswordUrl()) ?>" x-element-transition-trigger>
                    <span><?= $escaper->escapeHtml(__('Forgot Your Password?')) ?></span>
                </a>
                <button type="submit" class="button button--filled-primary mt-7 w-full py-4 " name="send">
                    <span><?= $escaper->escapeHtml(__('Sign In')) ?></span>
                </button>
                <div class="mt-4">
                    <?= $block->getBlockHtml('recaptcha_input_field_recaptcha') ?>
                </div>
                <div x-show="displayErrorMessage" class="mt-3">
                    <p class="text-red" x-text="generalErrorMessage"></p>
                </div>
                <template x-for="(value, key) in errorMessages" :key="key">
                    <div>
                        <p class="text-error" x-text="value"></p>
                    </div>
                </template>

                <div class="mt-6 text-center text-sm tracking-wider">
                    <a href="<?= $this->getUrl('customer/account/create') ?>" class="link link--primary text-md" x-element-transition-trigger>
                        <?= $escaper->escapeHtml(__('Create new account')) ?>
                    </a>
                </div>
            </fieldset>
        </form>
    </div>
</div>
