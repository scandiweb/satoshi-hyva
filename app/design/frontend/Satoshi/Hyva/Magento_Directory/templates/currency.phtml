<?php

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\Currency;
use Magento\Framework\Escaper;
use Satoshi\Theme\Block\Template;

/** @var Template $template */
/** @var Escaper $escaper */
/** @var ViewModelRegistry $viewModels */

/** @var Currency $currencyViewModel */
$currencyViewModel = $viewModels->require(Currency::class);

$options = [];
foreach ($currencyViewModel->getCurrencies() as $code => $currency) {
    $options[] = [
        'value' => $escaper->escapeHtml($code),
        'label' => $escaper->escapeHtml($currency['name']) . ' | ' . $escaper->escapeHtml($code) . ' (' . $escaper->escapeHtml($currency['symbol']) . ')',
        'on_click' => "hyva.postForm({$currencyViewModel->getSwitchCurrencyPostData($code)})"
    ];
}

$template
    ->setData([
        'id' => 'currency-selector',
        'label' => $escaper->escapeHtml($currencyViewModel->getCurrentCurrencyCode()),
        'withSearch' => true,
        'options' => $options,
    ])
    ->render('Magento_Theme:html/dropdown.phtml');

?>
