<?php

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\HeroiconsOutline;
use Magento\Framework\Escaper;
use Magento\LayeredNavigation\Block\Navigation\State;
use Hyva\Theme\ViewModel\SvgIcons;

/** @var State $block */
/** @var Escaper $escaper */
/** @var ViewModelRegistry $viewModels */
/** @var HeroiconsOutline $heroicons */
/** @var SvgIcons $hyvaicons */

$hyvaicons = $viewModels->require(SvgIcons::class); ?>

<?php $filters = $block->getActiveFilters() ?>
<div class="overflow-x-scroll overscroll-x-contain"
     x-show="!$store.main.isMobile || $store.popup.currentPopup === 'bottom-filters'">
    <div class="">

        <div id="selected-filters-mobile" class="shrink-0 grow"></div>

        <div x-data="Fetch()">
            <div class="mb-5 hidden items-center justify-between md:flex">
                <h2 class="text-text-500"><?= __('Selected filters') ?></h2>
                <?php if (!empty($filters)): ?>
                    <?php if ($block->getLayer()->getState()->getFilters()): ?>
                        <button
                            class="link link--primary"
                            @click="fetchPage('<?= $escaper->escapeUrl($block->getClearUrl()) ?>')"
                        >
                            <?= $escaper->escapeHtml(__('Reset All')) ?>
                        </button>
                    <?php endif; ?>
                <?php endif; ?>
            </div>
            <?php if (empty($filters)): ?>
                <div>
                    <p class="pr-3 text-center md:pr-0 md:text-left">
                        <?= __('The selected filters will appear here.') ?>
                    </p>
                </div>
            <?php endif; ?>
            <?php if (!empty($filters)): ?>
                <div class="flex flex-col md:gap-3 md:pb-7 md:pt-2">
                    <?php foreach ($filters as $filter): ?>
                        <div>
                            <button
                                type="button"
                                class="button button--outline-secondary button--size-sm mr-3 shrink-0 md:mr-0"
                                @click="fetchPage('<?= $escaper->escapeUrl($filter->getRemoveUrl()) ?>')"
                            >
                            <span class="mr-2">
                                <?= $escaper->escapeHtml(__($filter->getName())) ?>:
                            </span>
                                <span>
                                <?= $escaper->escapeHtml($block->stripTags($filter->getLabel())) ?>
                            </span>
                                <span class="ml-3 text-lg">
                                <?= $hyvaicons->renderHtml('close'); ?>
                            </span>
                            </button>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php endif; ?>
        </div>
    </div>
</div>
</div>
